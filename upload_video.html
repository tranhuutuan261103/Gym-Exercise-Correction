<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
    </head>
    <body>
        <input type="file" id="fileInput" />
        <script>
            function padZero(number) {
                return (number < 10 ? "0" : "") + number;
            }

            const getCurrentDateTime = function () {
                const date = new Date();
                const year = date.getFullYear();
                const month = padZero(date.getMonth() + 1);
                const day = padZero(date.getDate());
                const hours = padZero(date.getHours());
                const minutes = padZero(date.getMinutes());
                const seconds = padZero(date.getSeconds());
                return `${year}${month}${day}${hours}${minutes}${seconds}`;
            };

            const chunkSize = 20 * 1024 * 1024;
            const fileInput = document.getElementById("fileInput");
            fileInput.addEventListener("change", async (e) => {
                const file = e.target.files[0];
                const totalChunks = Math.ceil(file.size / chunkSize);
                const apiUrl =
                    "http://localhost:9999/api/video/upload_chunks/plank";

                let chunkIndex = 0;
                const formattedTime = getCurrentDateTime();
                while (chunkIndex < totalChunks) {
                    const start = chunkIndex * chunkSize;
                    const end = Math.min(start + chunkSize, file.size);
                    const chunk = file.slice(start, end);
                    const formData = new FormData();
                    formData.append("userId", "54U9rc8mD9Nbm4dpRAUNNm7ZYGw2");
                    formData.append("formattedTime", formattedTime);
                    formData.append("chunk", chunk);
                    formData.append("chunkIndex", chunkIndex);
                    formData.append("totalChunks", totalChunks);
                    formData.append("file", file);
                    const response = await fetch(apiUrl, {
                        method: "POST",
                        body: formData,
                    });
                    const data = await response.json();
                    console.log(data);
                    chunkIndex++;
                }
            });
        </script>
    </body>
</html>
